# Claude Code プロジェクト記録

## 画像表示問題の根本原因と解決策（2025-09-02）

### 問題の根本原因

#### 1. **ファイル配置とパス指定方式の不一致**
- **原因**: 画像ファイルを`public`フォルダから`src`フォルダに移動したにも関わらず、一部のコンポーネントで`process.env.PUBLIC_URL`を使った参照が残っていた
- **具体的問題箇所**: 
  - Navigation/CyberNav.jsx
  - Navigation/MobileNav.jsx
  - その他15個のコンポーネント

#### 2. **GitHub Pagesデプロイメントの技術的問題**
- **原因**: `gh-pages`パッケージが作成した不正なGitサブモジュール参照
- **エラー**: `No url found for submodule path 'node_modules/.cache/gh-pages/...' in .gitmodules`

#### 3. **ビルドプロセスとデプロイの連携不備**
- **原因**: `docs`フォルダの内容が最新のビルド結果と同期されていなかった

### 正しい解決手順

#### **Reactでの画像処理の原則**
```javascript
// ❌ 間違い: srcフォルダ内の画像にPUBLIC_URLを使用
<img src={`${process.env.PUBLIC_URL}/2025/04/logo.png`} />

// ✅ 正しい: srcフォルダ内の画像はimportを使用  
import logo from '../../2025/04/logo.png';
<img src={logo} />
```

#### **GitHub Pagesデプロイの正しい手順**
1. `npm run build` でプロダクションビルド作成
2. `buildフォルダ` の内容を `docsフォルダ` にコピー
3. 変更をコミット・プッシュ
4. GitHub Pages設定で `/docs` フォルダからデプロイを選択

### 今後同じ問題を防ぐためのチェックリスト

#### **開発時のチェックポイント**
1. **画像パスの統一性確認**
   ```bash
   # すべてのPUBLIC_URL使用箇所を検索
   grep -r "process.env.PUBLIC_URL" src/
   ```

2. **ビルド前の画像パス検証**
   ```bash
   # 画像パス検証スクリプトの実行
   npm run check-images
   ```

3. **プロダクションビルドのテスト**
   ```bash
   npm run build
   # buildフォルダの内容確認
   ls -la build/static/media/
   ```

#### **デプロイ時のチェックポイント**
1. **ビルド成功の確認**
   - エラーメッセージがないか
   - 全画像が`static/media/`に配置されているか

2. **docsフォルダ更新の確認**
   ```bash
   # buildとdocsの同期確認
   diff -r build/ docs/
   ```

3. **GitHub Actions成功の確認**
   - pages build and deploymentワークフローが緑色か
   - エラーログにサブモジュール関連エラーがないか

### 教訓とベストプラクティス

#### **技術的教訓**
1. **Reactの静的アセット管理**
   - `src`フォルダ内の画像は必ずimport文を使用
   - `public`フォルダは最後の手段として使用
   - webpackの最適化を活用する

2. **デプロイメント管理**
   - ビルドプロセスとデプロイプロセスを分離
   - 自動化スクリプトでヒューマンエラーを防止
   - 段階的な確認手順の確立

#### **プロジェクト管理の教訓**
1. **変更の影響範囲把握**
   - ファイル移動時は全参照箇所を確認
   - 一括変更後の動作確認を徹底

2. **問題の早期発見**
   - 開発サーバーでの確認だけでなく、プロダクションビルドでの確認
   - 画像パス検証の自動化

### 重要な注意事項
- 画像ファイルの配置変更時には必ず全コンポーネントの参照方法を統一する
- ビルド・デプロイプロセスの各段階で確認を行う
- GitHub Pagesは静的ファイルホスティングなので、複雑なワークフローは不要

---
最終更新: 2025-09-02